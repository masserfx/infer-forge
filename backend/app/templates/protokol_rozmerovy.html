{% extends "base.html" %}

{% block title %}Rozměrový protokol - {{ order.number }}{% endblock %}

{% block extra_styles %}
.measurement-row {
    display: grid;
    grid-template-columns: 40px 2fr 1fr 1fr 1.5fr 100px;
    gap: 5px;
    align-items: center;
    padding: 8px 10px;
    border-bottom: 1px solid #eee;
    font-size: 9pt;
}
.measurement-row:nth-child(even) {
    background-color: #f8f9fa;
}
.measurement-header {
    display: grid;
    grid-template-columns: 40px 2fr 1fr 1fr 1.5fr 100px;
    gap: 5px;
    background-color: #1e3a5f;
    color: white;
    padding: 8px 10px;
    font-size: 9pt;
    font-weight: 600;
}
.ok-box {
    width: 20px;
    height: 20px;
    border: 1.5px solid #1e3a5f;
    border-radius: 2px;
    display: inline-block;
    vertical-align: middle;
    margin-right: 5px;
}
.nok-box {
    width: 20px;
    height: 20px;
    border: 1.5px solid #1e3a5f;
    border-radius: 2px;
    display: inline-block;
    vertical-align: middle;
}
{% endblock %}

{% block content %}
<h2 class="doc-title">Rozměrový protokol č. {{ protocol_number }}</h2>

<div class="info-grid">
    <div class="info-box">
        <h3>Údaje o protokolu</h3>
        <p><span class="label">Číslo:</span> <strong>{{ protocol_number }}</strong></p>
        <p><span class="label">Datum:</span> {{ today }}</p>
        <p><span class="label">Zakázka:</span> {{ order.number }}</p>
        {% if order.customer %}
        <p><span class="label">Zákazník:</span> {{ order.customer.company_name }}</p>
        {% endif %}
    </div>
    <div class="info-box">
        <h3>Informace o zakázce</h3>
        <p><span class="label">Stav:</span> {{ order.status.value }}</p>
        <p><span class="label">Priorita:</span> {{ order.priority.value }}</p>
        {% if order.due_date %}
        <p><span class="label">Termín:</span> {{ order.due_date.strftime('%d.%m.%Y') }}</p>
        {% endif %}
    </div>
</div>

{% if order.note %}
<div class="note">
    <strong>Poznámka k zakázce:</strong> {{ order.note }}
</div>
{% endif %}

<h3 style="color: #1e3a5f; margin: 20px 0 10px;">Protokol měření</h3>

<div class="measurement-header">
    <span>#</span>
    <span>Položka</span>
    <span>Jmenovitý rozměr</span>
    <span>Tolerance</span>
    <span>Naměřená hodnota</span>
    <span>Vyhodnocení</span>
</div>

{% for item in items %}
<div class="measurement-row">
    <span>{{ loop.index }}</span>
    <span>
        <strong>{{ item.name }}</strong><br>
        <small style="color: #666;">
            {% if item.dn %}DN {{ item.dn }}{% endif %}
            {% if item.pn %} / PN {{ item.pn }}{% endif %}
            {% if item.material %} - {{ item.material }}{% endif %}
        </small>
    </span>
    <span style="text-align: center;">_____________</span>
    <span style="text-align: center;">_____________</span>
    <span style="text-align: center;">_____________</span>
    <span style="text-align: center;">
        <span class="ok-box"></span> OK
        <span class="nok-box"></span> NOK
    </span>
</div>
{% endfor %}

<div class="note" style="margin-top: 20px;">
    <strong>Poznámka:</strong> Rozměry měřeny dle výkresu č. _____________, revize _______.<br>
    Použitý měřicí přístroj: ________________________________, kalibrace platná do: ___________
</div>

<h3 style="color: #1e3a5f; margin: 25px 0 10px;">Prohlášení o shodě</h3>
<div style="font-size: 9pt; margin: 15px 0;">
    <p>Potvrzujeme, že výše uvedené výrobky byly zkontrolovány dle požadavků ISO 9001:2016
    a vyhovují požadavkům na rozměrovou přesnost dle schválené dokumentace.</p>
</div>

<div class="signature-grid">
    <div class="signature-box">
        <div class="signature-line">Měřil</div>
    </div>
    <div class="signature-box">
        <div class="signature-line">Kontroloval</div>
    </div>
</div>
{% endblock %}
